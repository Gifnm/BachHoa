<main ng-controller="billsHistory-ctrl">
    <div class="px-3 py-2 bg-opacity-75 bg-gradient bg-primary text-white">
        <div class="container-fluid">
            <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
                <div class="d-flex align-items-center my-2 my-lg-0 me-lg-auto col text-white text-decoration-none">
                    <div class="d-flex align-items-center p-3 border-bottom border-3 col-12 col-md-6">
                        <label for="" style="width: 40%;">Nhập hóa đơn: </label><br>
                        <div class="autocomplete d-flex text-dark">
                            <input id="bill_ID" type="text" class="form-control" ng-model="bill_ID"
                                list="datalistBillID">
                            <datalist id="datalistBillID">
                                <option ng-repeat="billID in listBillID" value="{{billID}}">
                            </datalist>
                            <button class="btn btn-info text-white ms-2 shadow-lg">
                                <i class="bi bi-search" ng-click="find(bill_ID)" title="Tìm hóa đơn"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <ul class="nav col-12 col-lg-auto my-2 justify-content-center my-md-0 text-small">
                    <li class="d-flex align-items-center p-3">
                        <label for="" class="w-100">Từ ngày: </label><br>
                        <div class="ms-2">
                            <input id="from_Date" type="date" class="form-control" ng-model="fromDate"
                                ng-change="findByDate(fromDate, toDate, 0)">
                        </div>
                    </li>
                    <li class="d-flex align-items-center p-3">
                        <label for="" class="w-100">Đến ngày: </label><br>
                        <div class="ms-2">
                            <input id="to_Date" type="date" class="form-control" ng-model="toDate"
                                ng-change="findByDate(fromDate, toDate, 0)">
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div class="row p-0 m-0">
        <div class="col-12 p-4">
            <div class="tab-pane fade show table-responsive table border border-info rounded-2 mt-1" id="home"
                role="tabpanel" aria-labelledby="home-tab" style="height: fit-content;">
                <table class="table table-responsive text-center table-hover mb-0" id="body_bills">
                    <thead class="bg-info text-white">
                        <tr>
                            <th scope="col">Mã hóa đơn</th>
                            <th scope="col">Ngày xuất</th>
                            <th scope="col">Tổng tiền</th>
                            <th scope="col">Phải thu</th>
                            <th scope="col">Tiền mặt</th>
                            <th scope="col">Đã giảm</th>
                            <th scope="col">Tiền thối lại</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-if="isNull">
                            <td colspan="7">Không có dữ liệu</td>
                        </tr>
                        <tr ng-repeat="item in items" id="modal-show" data-bs-toggle="modal"
                            data-bs-target="#staticBackdrop" ng-click="showDetail(item.bill.billID)"
                            style="cursor: pointer;">
                            <td style="width: 10%;">{{item.bill.billID}}</td>
                            <td style="width: 15%; word-wrap: break-word;">
                                {{item.bill.timeCreate}}</td>
                            <td style="width: 10%;">{{item.bill.totalAmount | number}} VND</td>
                            <!-- Phải thu -->
                            <td style="width: 10%;">{{item.amountReceivable | number}} VND</td>
                            <td style="width: 15%;">{{item.bill.cash | number}} VND</td>
                            <td style="width: 15%;">{{item.bill.reduced | number}} VND</td>
                            <!-- Tiền thối lại -->
                            <td style="width: 15%;">{{item.bill.cash - item.amountReceivable | number}} VND
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="row">
                <div class="col-2">
                    <b class="count">{{totalBill}} Hóa đơn</b>
                </div>
                <div class="col-10 text-end">
                    <button ng-click="findByDate(fromDate,toDate,index - 1)"
                        class="btn btn-outline-primary {{index == 0 ? 'disabled':''}}">Trước</button>
                    <button ng-repeat="item in pages" ng-click="findByDate(fromDate,toDate,item - 1)"
                        class="btn btn-outline-primary {{index == item - 1? 'active':''}} m-1 mb-0 mt-0"><b>
                            {{item}}</b> </button>
                    <button ng-click="findByDate(fromDate,toDate,index + 1)"
                        class="btn btn-outline-primary {{index == maxPage - 1 ? 'disabled':''}}">Sau</button>
                </div>
            </div>
            <!-- Modal -->
            <div class="modal fade modal-xl" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false"
                tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="staticBackdropLabel">Chi tiết hóa đơn</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="d-flex">
                                <div class="d-flex align-items-center p-3">
                                    <label for="ID_{{bill.billID}}" class="me-2">Mã hóa đơn: </label><br>
                                    <span id="{{bill.billID}}" name="{{bill.billID}}" class="fw-bold">
                                        {{bill.billID}}
                                    </span>
                                </div>
                                <div class="d-flex align-items-center p-3">
                                    <label for="storeID" class="me-2">Ngày xuất: </label><br>
                                    <span id="storeID" name="bill.timeCreate" class="fw-bold">
                                        {{bill.timeCreate}}
                                    </span>
                                </div>
                                <div class="d-flex align-items-center p-3">
                                    <label for="storeID" class="me-2">Nhân viên xuất: </label><br>
                                    <span id="storeID" name="bill.employee.employeeName" class="fw-bold">
                                        {{bill.employee.employeeName}}
                                    </span>
                                </div>
                            </div>
                            <div class="overflow-auto">
                                <table class="table table-responsive table-bordered border-info">
                                    <thead>
                                        <tr class="bg-primary text-white">
                                            <th scope="col">Mã sản phẩm</th>
                                            <th scope="col">Tên sản phẩm</th>
                                            <th scope="col">Số lượng</th>
                                            <th scope="col">Đơn giá (Có VAT)</th>
                                            <th scope="col">Khuyến mãi</th>
                                            <th scope="col">Thành tiền</th>
                                            <!-- <th scope="col">Bỏ</th> -->
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat="item in billDetails">
                                            <td style="width: 13%;">{{item.product.productID}}</td>
                                            <td style="word-wrap: break-word; width: 25%;">
                                                {{item.product.productName}}</td>
                                            <td style="width: 8%;">{{item.quantity}}</td>
                                            <!-- <input type="number" ng-model="item.quantity" min="1" ng-change="update(item.product.productID, item.quantity)"> -->
                                            <td style="width: 15%;">{{item.product.price + item.product.price *
                                                (item.product.vat/100) | number}}</td>
                                            <td style="width: 15%;">{{item.discountName}}</td>
                                            <td style="width: 15%;">{{item.totalAmount | number}}</td>
                                            <!-- <td style="width: 1%;"><button
                                                        ng-click="deleteItem(item.billID, item.productID)"
                                                        type="button" class="btn-close"></td> -->
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <div class="d-flex">
                                <div class="d-flex align-items-center p-3">
                                    <label for="storeID" class="me-2">Phải thu: </label><br>
                                    <span class="fw-bold">
                                        {{bill.amountReceivable | number}} VND
                                    </span>
                                </div>
                                <div class="d-flex align-items-center p-3">
                                    <label for="storeID" class="me-2">Tổng tiền: </label><br>
                                    <span class="fw-bold">
                                        {{bill.totalAmount | number}} VND
                                    </span>
                                </div>
                                <div class="d-flex align-items-center p-3">
                                    <label for="storeID" class="me-2">Đã giảm: </label><br>
                                    <span class="fw-bold">
                                        {{bill.reduced | number}} VND
                                    </span>
                                </div>
                                <div class="d-flex align-items-center p-3">
                                    <label for="storeID" class="me-2">Tiền mặt: </label><br>
                                    <span class="fw-bold">
                                        {{bill.cash | number}} VND
                                    </span>
                                </div>
                            </div>
                            <div class="d-flex justify-content-center w-100">
                                <!-- <button ng-click="delete(bill.billID)" type="button" class="btn btn-danger me-4" style="width: 17%;" data-bs-dismiss="modal" aria-label="Close">Xóa</button> -->
                                <!-- <button type="button" class="btn btn-info me-4" style="width: 17%;">Cập
                                        nhật</button> -->
                                <a href="/print/{{bill.billID}}" class="btn btn-primary" style="width: 17%;">Xuất hóa
                                    đơn</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="d-flex bg-primary bg-opacity-75 bg-gradient text-center text-lg-start fixed-bottom">
        <div class="d-flex align-items-center p-3">
            <label for="storeID" class="me-2">Xuất bản tại cửa hàng: </label><br>
            <span id="storeID" name="item.storeID" class="fw-bold">
                {{employee.store.address}}
            </span>
        </div>
        <div class="d-flex align-items-center p-3">
            <label for="storeID" class="me-2">Tổng thu: </label><br>
            <span class="fw-bold">
                {{totalAmountOfAllBills | number}} VND
            </span>
        </div>
    </footer>

    <!-- js -->
    <script src="../js/billsHistory.js"></script>
</main>